(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-357d883b"],{3835:function(e,t,a){"use strict";function n(e){if(Array.isArray(e))return e}function r(e,t){var a=[],n=!0,r=!1,s=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done);n=!0)if(a.push(i.value),t&&a.length===t)break}catch(l){r=!0,s=l}finally{try{n||null==c["return"]||c["return"]()}finally{if(r)throw s}}return a}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){return n(e)||r(e,t)||s()}a.d(t,"a",function(){return i})},"67ea":function(e,t,a){},8435:function(e,t,a){"use strict";var n=a("ed3f"),r=a.n(n);r.a},d18b:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Appeals"},[e._m(0),e.current_user?e._e():a("el-alert",{staticClass:"notice",attrs:{closable:!1,type:"warning",center:"","show-icon":"",title:"Только зарегистрированные пользователи могут оставлять обращения."}}),a("div",{staticClass:"container"},[a("h3",{staticClass:"caption"},[e._v("1) Опишите проблему")]),a("el-input",{staticClass:"title",attrs:{rows:5,disabled:!e.current_user,placeholder:"О чём хотите сообщить?",type:"textarea",autosize:""},model:{value:e.appeal.description,callback:function(t){e.$set(e.appeal,"description",t)},expression:"appeal.description"}}),a("h3",{staticClass:"caption"},[e._v("2) Какие решения Вы видите?")]),a("el-input",{staticClass:"description",attrs:{rows:5,disabled:!e.current_user,type:"textarea",autosize:"",placeholder:"Предложите свои решения проблемы"},model:{value:e.appeal.proposal,callback:function(t){e.$set(e.appeal,"proposal",t)},expression:"appeal.proposal"}}),a("h3",{staticClass:"caption"},[e._v("3) Прикрепите вложение")]),a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.isSendingAttachment,expression:"isSendingAttachment"}],staticClass:"file-container"},[a("label",{class:["file",{disabled:!e.current_user}]},[a("input",{attrs:{disabled:!e.current_user,type:"file",hidden:""},on:{change:e.getAttachment}}),e._v("\n        Прикрепить\n      ")]),e._l(e.fileNames,function(t,n){return a("div",{key:n,staticClass:"attached"},[e._v("\n        Прикреплённый файл: "+e._s(t)+"\n      ")])})],2),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.isSendingAppeal,expression:"isSendingAppeal"}],staticClass:"send",attrs:{disabled:!e.current_user||e.isSendingAttachment,type:"primary"},on:{click:e.sendAppeal}},[e._v("\n      Отправить\n    ")])],1)],1)},r=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"header"},[a("div",{staticClass:"wrapper"},[a("h1",{staticClass:"title"},[e._v("Оставить обращение")])])])}],s=(a("96cf"),a("1da1")),i=(a("7f7f"),a("3835")),c=a("be94"),l=(a("cadf"),a("551c"),a("097d"),a("2f62")),o={name:"Appeals",metaInfo:{title:"Обращение гражданина"},data:function(){return{appeal:{proposal:"",description:"",attachments:[]},fileNames:[],attachment:void 0,isSendingAttachment:!1,isSendingAppeal:!1}},computed:Object(c["a"])({},Object(l["b"])("auth",["current_user"])),methods:{getAttachment:function(e){var t=this,a=Object(i["a"])(e.target.files,1),n=a[0],r=new FileReader;r.readAsArrayBuffer(n),this.fileNames.push(n.name),r.onload=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t.attachment=r.result,e.next=3,t.sendAttachment();case 3:case"end":return e.stop()}},e,this)})),r.onerror=function(e){console.error("Get Attachment Error:",e)}},sendAttachment:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.isSendingAttachment=!0,t=new FormData,t.append("file",new Blob([this.attachment])),e.prev=3,e.next=6,this.$http({method:"post",url:"/civil_appeals/attachment",config:{headers:{"Content-Type":"multipart/form-data"}},data:t});case 6:a=e.sent,n=a.data,this.$message.success("Вложение успешно загружено!"),this.appeal.attachments.push(n),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](3),this.$message.error("Вложение не загружено!"),console.dir(e.t0);case 16:return e.prev=16,this.isSendingAttachment=!1,e.finish(16);case 19:case"end":return e.stop()}},e,this,[[3,12,16,19]])}));return function(){return e.apply(this,arguments)}}(),sendAppeal:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.isSendingAppeal=!0,e.prev=1,e.next=4,this.$http.post("/civil_appeals",{civil_appeal:this.appeal});case 4:this.$message.success("Обращение успешно отправлено!"),this.$router.push({name:"Surveys"}),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](1),this.$message.error("Обращение не отправлено!"),console.dir(e.t0);case 12:return e.prev=12,this.isSendingAppeal=!1,e.finish(12);case 15:case"end":return e.stop()}},e,this,[[1,8,12,15]])}));return function(){return e.apply(this,arguments)}}()}},p=o,u=(a("e741"),a("8435"),a("2877")),d=Object(u["a"])(p,n,r,!1,null,"39fe04c6",null);d.options.__file="Appeals.vue";t["default"]=d.exports},e741:function(e,t,a){"use strict";var n=a("67ea"),r=a.n(n);r.a},ed3f:function(e,t,a){}}]);
//# sourceMappingURL=chunk-357d883b.059cf012.js.map